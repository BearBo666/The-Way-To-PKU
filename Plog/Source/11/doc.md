# 全局说明

## 端口

- 服务：9857
- mysql：3307
- redis：6380



## 状态码

- 【状态码：20000及以上表示客户端错误，30000及以上代表服务端错误】



## 秒杀流程

1. 判断活动是否结束
2. 校验token
3. 校验authCode（5min内有效，与userId对应）
4. 规则引擎校验（暂时没加，看进度是否写）
5. 如果产品还有剩余数量，则返回一个orderId
6. 用户带着orderId去请求付款接口



# 数据模型

## 说明

- 【模型即数据库中的表，JsonNullInt64就是int类型，下列结构体是大驼峰，前端接收到的结构体是小驼峰。】



## 管理员

![image-20220325203129200](image-20220325203129200.png)

## 用户

![image-20220325203144771](image-20220325203144771.png)

## 活动

![image-20220325203331463](image-20220325203331463.png)

## 产品

【每个产品归属于一个活动，即一对一】

![image-20220325203348734](image-20220325203348734.png)





# 接口

## 说明

- 【每个接口的参数对应一个dto结构体，结构体后面的`form`标签代表该参数在http的body的key值，binding代表是否必填】
- 【**若是更新接口，需要传递一个attrs字段**，用来表示需要更新哪些字段，各字段之间用逗号分开，如：`userName,isDel,desc`】
- 【一些涉及到增加和更新的接口需要管理员token，涉及到更用户相关的接口需要用户token，**token在header中，key是authToken**】



## 用户 /user

### 注册	/register

![image-20220325203447554](image-20220325203447554.png)

### 登录    /login

![image-20220325203532241](image-20220325203532241.png)



## 管理员 /admin

### 注册	/register

![image-20220325203553218](image-20220325203553218.png)

### 登录    /login

![image-20220325203558433](image-20220325203558433.png)





## 活动   /activity

### 添加  /add

![image-20220325203739706](image-20220325203739706.png)

### 更新  /update

传递isDel为1即可实现删除，故没写删除接口

![image-20220325203754963](image-20220325203754963.png)

### 查询  /list



## 产品   /product

### 添加     /add

![image-20220325204605325](image-20220325204605325.png)

### 更新	/update

![image-20220325204612948](image-20220325204612948.png)

### 查询	/list

### 获得验证码  /authCode

### 秒杀     /miaosha/:aid/:pid

- aid代表活动的id

- pid代表产品的id

